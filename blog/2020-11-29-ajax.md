---
slug: ajax
title: ç½‘ç»œè¯·æ±‚
author: Cansiny0320
author_title: å‰ç«¯å¼€å‘è€…
author_url: https://github.com/Cansiny0320
author_image_url: https://gitee.com/cansiny0320/file-bed/blob/master/logo.jpgssig=EvXmyu%2FXsX
tags: [JavaScript]
---

è¿™æ˜¯ä¸€ç¯‡è®²è¯¾çš„è¯¾ä»¶ ä¸»è¦æ¶‰åŠå‰ç«¯ç½‘ç»œè¯·æ±‚

<!--truncate-->

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613645877253.png)

## ğŸ“– å‰è¨€

ä¹‹å‰æˆ‘ä»¬åšçš„é¡µé¢éƒ½æ˜¯ä¸€äº›æ²¡æœ‰æ•°æ®çš„**é™æ€é¡µé¢**(è™½ç„¶ä½ å¯èƒ½å†™äº†ä¸€äº›åŠ¨ç”»æ•ˆæœï¼Œå¯å®ƒå´ä»ç„¶æ˜¯ä¸ªé™æ€é¡µé¢)ã€‚é‚£ä¹ˆï¼Œå•¥å«**åŠ¨æ€é¡µé¢**å‘¢ï¼Ÿè¿™å°±æ˜¯å‰ç«¯è·Ÿç½‘ç»œè¯·æ±‚çš„å…³ç³»äº†ï¼Œå¦‚æœä¸€ä¸ªç½‘é¡µåœ¨ä½ ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå‘æœåŠ¡å™¨å‘å‡ºäº†æŸäº›ç½‘ç»œè¯·æ±‚ï¼Œå¹¶æ¥æ”¶åˆ°äº†ä»æœåŠ¡å™¨è¿”å›æ¥çš„æ•°æ®ï¼ˆå½“ç„¶ä¹Ÿå¯èƒ½è¯·æ±‚å¤±è´¥ï¼‰ï¼Œé‚£ä¹ˆï¼Œè¿™æ ·çš„ç½‘é¡µæ‰å«åšåŠ¨æ€é¡µé¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„**åŠ¨æ€**æŒ‡çš„æ˜¯ä½ çš„æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰å’ŒæœåŠ¡å™¨ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰çš„æ•°æ®äº¤æ¢ã€‚

ä½œä¸ºä¸€ä¸ªçœŸæ­£çš„å‰ç«¯ï¼Œæ‰€åšçš„äº‹å°±æ˜¯è´Ÿè´£ä»å®¢æˆ·ç«¯è·å–ç”¨æˆ·çš„æ•°æ®ï¼ˆåƒæ˜¯ä½ å¡«å†™çš„ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œç„¶åï¼ŒæŠŠè¿™äº›æ•°æ®ç»„ç»‡èµ·æ¥ï¼Œå‘ç»™æœåŠ¡å™¨ç«¯ï¼Œç„¶åç­‰å¾…æœåŠ¡å™¨ç«¯å¤„ç†å®Œæ•°æ®ï¼ˆè‡³äºæœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®æ€ä¹ˆå¤„ç†ï¼Œå°±æ˜¯åç«¯çš„é—®é¢˜äº†ï¼‰ï¼Œæ¥æ”¶è¿”å›çš„æ•°æ®ï¼Œå¹¶å¯¹è¿™äº›è¿”å›çš„æ•°æ®è¿›è¡Œä¸åŒçš„å¤„ç†ï¼ˆæ¯”å¦‚å±•ç¤ºåœ¨é¡µé¢ä¸Šæˆ–è€…å‚¨å­˜èµ·æ¥ä¹‹ç±»çš„ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†™å‡ºä¸€ä¸ªæ¼‚äº®çš„é¡µé¢å±•ç¤ºç»™åˆ«äººåªæ˜¯å‰ç«¯å·¥ä½œçš„ä¸€éƒ¨åˆ†ã€‚

ä»‹ç»å‰ç«¯ç½‘ç»œè¯·æ±‚æ–¹æ³•ä¹‹å‰æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸€äº›å‰ç½®çŸ¥è¯†ï¼š

## JSON

> **J**ava**S**cript **O**bject **N**otation(JavaScript å¯¹è±¡è¡¨ç¤ºæ³•)æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚

é¦–å…ˆï¼Œ JSON çš„æœ¬è´¨æ˜¯ä¸€ç§æ•°æ®çš„æ ¼å¼ï¼Œå–ä»£çš„æ˜¯ XML ã€‚é‚£ä¹ˆï¼Œè¿™å“¥ä¿©çš„ä½œç”¨æ˜¯å•¥å‘¢ï¼Ÿå…¶å®å°±æ˜¯ä¸€ä¸ªä¼ è¾“åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯åœ¨ç½‘ç»œè¯·æ±‚çš„ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®çš„æ ¼å¼å¿…é¡»æ˜¯ JSON æ ¼å¼ã€‚æ‰€ä»¥ï¼Œ JSON ä¸æ­¢æ˜¯å‰ç«¯è¦ç”¨çš„ä¸œè¥¿ï¼Œåç«¯åœ¨å‘å‰ç«¯ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ ·ä¹Ÿå¾—å…ˆæŠŠæ•°æ®æ ¼å¼è½¬åŒ–æˆ JSON æ ¼å¼ï¼Œå†è¿›è¡Œä¼ è¾“ã€‚è‡³äºä¸ºå•¥è¦å–ä»£ä»¥å‰çš„ XML æ ¼å¼ï¼Œå¾ˆå¥½ç†è§£ï¼Œ JSON æ ¼å¼ç®€å•å‘—ã€‚

ä¸‹é¢ç»™ä¸€ä¸ª json å®ä¾‹ï¼š

```json
{
  "data": [
    {
      "id": 1,
      "name": "wjx",
      "age": 19
    },
    {
      "id": 2,
      "name": "xjw",
      "age": 20
    },
    {
      "id": 3,
      "name": "jwx",
      "age": 21
    }
  ],
  "info": "success",
  "status": 10000
}
```

**js ä¸­è§£æ JSON çš„æ–¹æ³•**

- `JSON.stringify(obj)` js å¯¹è±¡è½¬ json,è¿”å›ä¸€ä¸ª json æ ¼å¼å­—ç¬¦ä¸²
- `JSON.parse(json)` json è½¬ js å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡

## URL

> ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼Œç¼©å†™ä¸º URLï¼‰ï¼Œåˆå«åšç½‘é¡µåœ°å€ï¼Œæ˜¯äº’è”ç½‘ä¸Šæ ‡å‡†çš„èµ„æºçš„åœ°å€ï¼ˆAddressï¼‰ã€‚

æ¯”å¦‚è¯´ www.baidu.com å°±æ˜¯ä¸€ä¸ªç®€å•çš„ url

### URL ç»„æˆ

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646033758.png)

- **protocol** åè®®ï¼Œå¸¸ç”¨çš„åè®®æ˜¯ `HTTP`**ã€**`HTTPS`ã€`ftp`

- **hostname** ä¸»æœºåœ°å€ï¼Œ`åŸŸå`æˆ–è€…`IP`ï¼Œæ¯”å¦‚`baidu.com`

- **port** ç«¯å£ï¼Œhttp åè®®é»˜è®¤ç«¯å£æ˜¯ 80 ç«¯å£ï¼Œhttps åè®®é»˜è®¤ 443 ç«¯å£

- path è·¯å¾„ï¼Œç½‘ç»œèµ„æºåœ¨æœåŠ¡å™¨ä¸­çš„æŒ‡å®šè·¯å¾„

- query æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¦‚æœéœ€è¦ä»æœåŠ¡å™¨é‚£é‡ŒæŸ¥è¯¢å†…å®¹ï¼Œåœ¨è¿™é‡Œç¼–è¾‘,å¤šä¸ª query å‚æ•°ç”¨&ç¬¦å·è¿æ¥

- hash ç‰‡æ®µï¼Œç½‘é¡µä¸­å¯èƒ½ä¼šåˆ†ä¸ºä¸åŒçš„ç‰‡æ®µï¼Œå¦‚æœæƒ³è®¿é—®ç½‘é¡µåç›´æ¥åˆ°è¾¾æŒ‡å®šä½ç½®ï¼Œå¯ä»¥åœ¨è¿™éƒ¨åˆ†è®¾ç½®

**URL å’Œ URI**

URI, å…¨ç§°ä¸º(Uniform Resource Identifier), ä¹Ÿå°±æ˜¯ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼Œå®ƒçš„ä½œç”¨å¾ˆç®€å•ï¼Œå°±æ˜¯åŒºåˆ†äº’è”ç½‘ä¸Šä¸åŒçš„èµ„æºã€‚

ä½†æ˜¯ï¼Œå®ƒå¹¶ä¸æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç½‘å€, ç½‘å€æŒ‡çš„æ˜¯ URL, å®é™…ä¸Š URI åŒ…å«äº† URN å’Œ URL ä¸¤ä¸ªéƒ¨åˆ†ï¼Œç”±äº URL è¿‡äºæ™®åŠï¼Œå°±é»˜è®¤å°† URI è§†ä¸º URL äº†ã€‚

## äº†è§£ HTTP

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646053782.png)

> HTTP åè®®ï¼ˆHyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯å› ç‰¹ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼Œæ‰€æœ‰çš„ WWW æ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ª**æ ‡å‡†**ã€‚

### æ–¹æ³•

- **GETï¼šè·å–èµ„æº**

- **POSTï¼šä¼ è¾“å®ä½“ä¸»ä½“ï¼Œä¸»è¦ç›®çš„æ˜¯ä¼ è¾“**

- PUTï¼šä¼ è¾“æ–‡ä»¶ï¼Œä¿å­˜åˆ°æŒ‡å®šçš„ä½ç½®

- HEADï¼šè·å¾—æŠ¥æ–‡é¦–éƒ¨

- DELETEï¼šåˆ é™¤æ–‡ä»¶

- OPTIONSï¼šæŸ¥è¯¢æ”¯æŒçš„æ–¹æ³•

- TRACEï¼šè¿½è¸ªè·¯å¾„

- CONNECTï¼šè¦æ±‚ä½¿ç”¨éš§é“åè®®è¿æ¥ä»£ç†

### å¸¸è§çŠ¶æ€ç 

- 2XX æˆåŠŸ

  - 200 OKï¼šè¯·æ±‚æˆåŠŸ

  - 204 No Contentï¼šè¯·æ±‚å¤„ç†æˆåŠŸï¼Œä½†æ²¡æœ‰èµ„æºå¯è¿”å›

- 3XX é‡å®šå‘

  - 301 Moved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘

  - 302 Foundï¼šä¸´æ—¶é‡å®šå‘

  - 304 Not Modifiedï¼šæœåŠ¡ç«¯èµ„æºæœªæ”¹å˜ï¼Œå¯ä½¿ç”¨ç¼“å­˜ï¼ˆå’Œé‡å®šå‘æ— å…³ï¼‰

- 4XX å®¢æˆ·ç«¯é”™è¯¯

  - 400 Bad Requestï¼šè¯·æ±‚æŠ¥æ–‡è¯­æ³•é”™è¯¯

  - 401 Unauthorizedï¼šè¯·æ±‚éœ€è®¤è¯

  - 403 Forbiddenï¼šä¸å…è®¸è®¿é—®èµ„æº

  - 404 Not Foundï¼šæœåŠ¡å™¨æ— è¯·æ±‚èµ„æº

- 5XX æœåŠ¡å™¨é”™è¯¯

  - 500 Internal Server Errorï¼šæœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯

  - 503 Service Unavaiableï¼šæœåŠ¡å™¨è¶…è´Ÿè½½

### HTTP æŠ¥æ–‡

ç”¨äº HTTP åè®®äº¤äº’çš„ä¿¡æ¯è¢«ç§°ä¸º HTTP æŠ¥æ–‡ï¼Œå®¢æˆ·ç«¯çš„å«åšè¯·æ±‚æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯çš„å«åšå“åº”æŠ¥æ–‡ã€‚

**è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡çš„ç»“æ„**

ç»“æ„ä¸»è¦æ˜¯æŠ¥æ–‡é¦–éƒ¨ã€ç©ºè¡Œï¼ˆCR+LFï¼‰ã€æŠ¥æ–‡ä¸»ä½“ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæ¸…æ¥šæ˜äº†ã€‚

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646180855.png)

å…¶ä¸­è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡æ˜¯æœ‰ä¸€å®šåŒºåˆ«çš„

è¯·æ±‚æŠ¥æ–‡çš„è¯·æ±‚è¡Œé•¿è¿™æ ·

```http
GET /home HTTP/1.1
```

åŒ…å«äº†è¯·æ±‚æ–¹æ³• + URL + HTTP ç‰ˆæœ¬

è€Œå“åº”æŠ¥æ–‡çš„çŠ¶æ€è¡Œé•¿è¿™æ ·

```http
HTTP/1.1 200 OK
```

åŒ…å« HTTP ç‰ˆæœ¬ + çŠ¶æ€ç  + åŸå› çŸ­è¯­

è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡å®ä¾‹

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646190498.png)

ä¸Šé¢è¿™äº›éƒ½æ˜¯æœªç»è¿‡å¤„ç†çš„å½¢å¼ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è§£æä¸ºæ–¹ä¾¿æŸ¥çœ‹çš„æ ¼å¼

æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„å°±æ˜¯` è¯·æ±‚url`ï¼Œ`è¯·æ±‚æ–¹æ³•`ä»¥åŠ`çŠ¶æ€ç `

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646202536.png)

å¤´éƒ¨å­—æ®µéå¸¸çš„å¤šï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œåªä»‹ç»ä¸€ä¸‹å¤´éƒ¨å­—æ®µçš„æ ¼å¼

- å­—æ®µåä¸åŒºåˆ†å¤§å°å†™
- å­—æ®µåä¸å…è®¸å‡ºç°ç©ºæ ¼ï¼Œä¸å¯ä»¥å‡ºç°ä¸‹åˆ’çº¿\_
- å­—æ®µååé¢å¿…é¡»ç´§æ¥ç€ :

## ğŸ›«AJAX

> `Ajax`å…¨ç§°`Asynchronous JavaScript + XML`ï¼ˆç”¨ JavaScript æ‰§è¡Œå¼‚æ­¥ç½‘ç»œè¯·æ±‚ï¼‰ã€‚å®ƒçš„æœ¬è´¨å°±æ˜¯ç”¨æ¥å‘æœåŠ¡å™¨ç«¯å‘å‡ºç½‘ç»œè¯·æ±‚çš„ä¸€ç§æ–¹æ³•ã€‚

æ¯”å¦‚è¯´ä¸‹é¢å°±æ˜¯ä¸€ä¸ª ajax çš„å®ä¾‹

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646471870-ajax.gif)

åœ¨`Ajax`å‡ºç°ä¹‹å‰ï¼Œ`web`ç¨‹åºæ˜¯è¿™æ ·å·¥ä½œçš„ï¼š

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646224461.png)

è¿™ç§äº¤äº’çš„çš„ç¼ºé™·æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä»»ä½•å’ŒæœåŠ¡å™¨çš„äº¤äº’éƒ½éœ€è¦åˆ·æ–°é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒéå¸¸å·®ï¼Œ`Ajax`çš„å‡ºç°å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

`Ajax`æœ¬èº«ä¸æ˜¯ä¸€ç§æ–°æŠ€æœ¯ï¼Œè€Œæ˜¯ç”¨æ¥æè¿°ä¸€ç§ä½¿ç”¨ç°æœ‰æŠ€æœ¯é›†åˆå®ç°çš„ä¸€ä¸ªæŠ€æœ¯æ–¹æ¡ˆï¼Œæµè§ˆå™¨çš„`XMLHttpRequest`æ˜¯å®ç°`Ajax`æœ€é‡è¦çš„å¯¹è±¡ï¼ˆ`IE6`ä»¥ä¸‹ä½¿ç”¨`ActiveXObject`ï¼Œåˆ«ç”¨ IEğŸ˜¥ï¼‰ã€‚

å°½ç®¡`X`åœ¨`Ajax`ä¸­ä»£è¡¨`XML`, ä½†ç”±äº`JSON`çš„è®¸å¤šä¼˜åŠ¿ï¼Œæ¯”å¦‚æ›´åŠ è½»é‡ä»¥åŠä½œä¸º`Javascript`çš„ä¸€éƒ¨åˆ†ï¼Œç›®å‰`JSON`çš„ä½¿ç”¨æ¯”`XML`æ›´åŠ æ™®éã€‚

### åŸç”Ÿ AJAX çš„ä½¿ç”¨

æˆ‘ä»¬å…ˆæ¥å¯¹`XMLHttpRequest`å¯¹è±¡å¸¸ç”¨çš„çš„å‡½æ•°ã€å±æ€§ã€äº‹ä»¶è¿›è¡Œåˆ†æã€‚

å…ˆç”©å¼ å›¾å‡ºæ¥

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646249859.png)

#### å‡½æ•°

**open**

ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚ï¼Œç”¨æ³•ï¼š

```js
xhr.open(method, url, async)
```

- `method`ï¼šè¯·æ±‚æ–¹å¼ï¼Œå¦‚`getã€post`
- `url`ï¼šè¯·æ±‚çš„`url`
- `async`ï¼šæ˜¯å¦ä¸ºå¼‚æ­¥è¯·æ±‚ é»˜è®¤ä¸º true

**send**

ç”¨äºå‘é€`HTTP`è¯·æ±‚ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•å`HTTP`è¯·æ±‚æ‰ä¼šè¢«çœŸæ­£å‘å‡ºï¼Œç”¨æ³•ï¼š

```js
xhr.send(param)
```

- `param`ï¼šhttp è¯·æ±‚çš„å‚æ•°ï¼Œå¯ä»¥ä¸º`stringã€Blob`ç­‰ç±»å‹ã€‚

**abort**

ç”¨äºç»ˆæ­¢ä¸€ä¸ª ajax è¯·æ±‚ï¼Œè°ƒç”¨æ­¤æ–¹æ³•å readyState å°†è¢«è®¾ç½®ä¸º 0ï¼Œç”¨æ³•ï¼š

```js
xhr.abort()
```

**setRequestHeader**

ç”¨äºè®¾ç½®`HTTP`è¯·æ±‚å¤´ï¼Œæ­¤æ–¹æ³•å¿…é¡»åœ¨`open()`æ–¹æ³•å’Œ`send()`ä¹‹é—´è°ƒç”¨ï¼Œç”¨æ³•ï¼š

```js
xhr.setRequestHeader(header, value)
```

**getResponseHeader**

ç”¨äºè·å– http è¿”å›å¤´ï¼Œå¦‚æœåœ¨è¿”å›å¤´ä¸­æœ‰å¤šä¸ªä¸€æ ·çš„åç§°ï¼Œé‚£ä¹ˆè¿”å›çš„å€¼å°±ä¼šæ˜¯ç”¨é€—å·å’Œç©ºæ ¼å°†å€¼åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œç”¨æ³•ï¼š

```js
const header = xhr.getResponseHeader(name)
```

#### å±æ€§

**readyState**

ç”¨æ¥æ ‡è¯†å½“å‰`XMLHttpRequest`å¯¹è±¡æ‰€å¤„çš„çŠ¶æ€ï¼Œ`XMLHttpRequest`å¯¹è±¡æ€»æ˜¯ä½äºä¸‹åˆ—çŠ¶æ€ä¸­çš„ä¸€ä¸ªï¼š

| å€¼  | çŠ¶æ€               | æè¿°                                               |
| --- | ------------------ | -------------------------------------------------- |
| 0   | `UNSENT`           | ä»£ç†è¢«åˆ›å»ºï¼Œä½†å°šæœªè°ƒç”¨ `open()` æ–¹æ³•ã€‚             |
| 1   | `OPENED`           | `open()` æ–¹æ³•å·²ç»è¢«è°ƒç”¨ã€‚                          |
| 2   | `HEADERS_RECEIVED` | `send()`æ–¹æ³•å·²ç»è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å¤´éƒ¨å’ŒçŠ¶æ€å·²ç»å¯è·å¾—ã€‚ |
| 3   | `LOADING`          | ä¸‹è½½ä¸­ï¼› `responseText` å±æ€§å·²ç»åŒ…å«éƒ¨åˆ†æ•°æ®ã€‚     |
| 4   | `DONE`             | ä¸‹è½½æ“ä½œå·²å®Œæˆã€‚                                   |

é€šè¿‡åˆ¤æ–­**readyState** æˆ‘ä»¬å¯ä»¥åšåˆ°ä¸€ä¸ªç­‰å¾…åŠ è½½çš„æ•ˆæœã€‚

```js
if (xhr.readyState !== 4) {
  // loading...
} else {
  // done
}
```

**status**

è¡¨ç¤º`http`è¯·æ±‚çš„çŠ¶æ€, åˆå§‹å€¼ä¸º`0`ã€‚å¦‚æœæœåŠ¡å™¨æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šçŠ¶æ€ç , é‚£ä¹ˆ`status`å°†è¢«è®¾ç½®ä¸ºé»˜è®¤å€¼, å³`200`ã€‚

é€šè¿‡åˆ¤æ–­**status**æˆ‘ä»¬å¯ä»¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ,ç‰¹åˆ«çš„ï¼Œ`304` ä¹Ÿæ˜¯æˆåŠŸçš„è¿”å›

**response**

è¿”å›å“åº”çš„æ­£æ–‡ï¼Œè¿”å›çš„ç±»å‹ç”±ä¸Šé¢çš„`responseType`å†³å®šã€‚

**withCredentials**

`ajax`è¯·æ±‚é»˜è®¤ä¼šæºå¸¦åŒæºè¯·æ±‚çš„`cookie`ï¼Œè€Œè·¨åŸŸè¯·æ±‚åˆ™ä¸ä¼šæºå¸¦`cookie`ï¼Œè®¾ç½®`xhr`çš„`withCredentials`çš„å±æ€§ä¸º`true`å°†å…è®¸æºå¸¦è·¨åŸŸ`cookie`ã€‚

è¿™é‡Œæåˆ°äº†è·¨åŸŸï¼Œè·¨åŸŸæ˜¯ä»€ä¹ˆæˆ‘ä»¬ç­‰ä¼šå†è®²

#### äº‹ä»¶å›è°ƒ

**onreadystatechange**

```js
xhr.onreadystatechange = callback
```

å½“`readyState`å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`callback` ä¼šè¢«è§¦å‘ã€‚

**onloadstart**

```js
xhr.onloadstart = callback
```

åœ¨`ajax`è¯·æ±‚å‘é€ä¹‹å‰ï¼ˆ`readyState==1`å, `readyState==2`å‰ï¼‰ï¼Œ`callback`ä¼šè¢«è§¦å‘ã€‚

**onprogress**

```js
xhr.onprogress = function (event) {
  console.log(event.loaded / event.total)
}
```

å›è°ƒå‡½æ•°å¯ä»¥è·å–èµ„æºæ€»å¤§å°`total`ï¼Œå·²ç»åŠ è½½çš„èµ„æºå¤§å°`loaded`ï¼Œç”¨è¿™ä¸¤ä¸ªå€¼å¯ä»¥è®¡ç®—åŠ è½½è¿›åº¦ã€‚

æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥çœ‹çœ‹å‘é€ä¸€ä¸ª ajax è¯·æ±‚éœ€è¦åšäº›ä»€ä¹ˆ

**onload**

```js
xhr.onload = callback
```

å½“ä¸€ä¸ªèµ„æºåŠå…¶ä¾èµ–èµ„æºå·²å®ŒæˆåŠ è½½æ—¶ï¼Œå°†è§¦å‘`callback`ã€‚

**onerror**

```js
xhr.onerror = callback
```

å½“`ajax`èµ„æºåŠ è½½å¤±è´¥æ—¶ä¼šè§¦å‘`callback`ã€‚

**ontimeout**

```js
xhr.ontimeout = callback
```

å½“è¯·æ±‚å“åº”è¶…æ—¶æ—¶ï¼Œä¼šè§¦å‘`callback`ï¼Œè¶…æ—¶æ—¶é—´å¯ä½¿ç”¨`timeout`å±æ€§è¿›è¡Œè®¾ç½®ã€‚

ä»‹ç»äº†`XMLHttpRequest`å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„ ajax è¯·æ±‚æ€ä¹ˆå†™ï¼Œ

é¦–å…ˆï¼Œå®ä¾‹åŒ–ä¸€ä¸ª `XMLHttpRequest `å¯¹è±¡

```js
const xhr = new XMLHttpRequest()
```

ç„¶åå†åˆå§‹åŒ–è¯·æ±‚ ï¼Œè®¾ç½®è¯·æ±‚æ–¹æ³•ï¼Œè¯·æ±‚ url å’Œæ˜¯å¦ä¸ºå¼‚æ­¥è¯·æ±‚

```js
xhr.open("get", "http://www.xxx.com/api", true)
```

è®¾ç½®ä¸€ä¸‹å¤„ç†å“åº”çš„å›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬çš„ä¸»è¦é€»è¾‘å°±åœ¨ callback é‡Œé¢å®ç°

```js
xhr.onreadystatechange = callback
```

æœ€åå‘é€æˆ‘ä»¬çš„è¯·æ±‚

```js
xhr.send()
```

è¿™ä¸ªè¯·æ±‚å°±å‘å‡ºå»äº†

ä¸‹é¢ç»™ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹

```js
//å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡
const xhr = new XMLHttpRequest()
//åˆå§‹åŒ–ä¸€ä¸ªgetè¯·æ±‚
xhr.open("get", "http://musicapi.leanapp.cn/personalized", true)
//æ¥æ”¶è¿”å›å€¼
xhr.onreadystatechange = () => {
  if (xhr.readyState === 4) {
    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
      const res = JSON.parse(xhr.responseText)
      console.log(res)
      console.log("è¯·æ±‚æˆåŠŸ")
      // do something
    } else {
      console.log("è¯·æ±‚å¤±è´¥")
    }
  }
}
//å‘é€è¯·æ±‚
xhr.send()
```

### å¦‚ä½•ä¼ å‚

æˆ‘ä»¬ç”¨ GET è¯·æ±‚æ—¶ï¼Œæ‰€å¸¦æ•°æ®åªèƒ½æ”¾åœ¨ URL ä¸Šï¼ŒæŒ‰ç…§çº¦å®šå‚æ•°çš„å†™æ³•ï¼ˆåªè¦åç«¯èƒ½å¤Ÿè§£é‡Šå‡ºæ¥å°±è¡Œï¼‰ï¼Œå‘ç»™åç«¯

å¸¸è§ï¼š

1. `http://api.xxx.com/user?name=wjx&age=19`

1. `http://api.xxx.com/user/123`

æˆ‘ä»¬çŸ¥é“ HTTP è¯·æ±‚æ–¹å¼ä¸æ­¢ GETâ€¦â€¦

æˆ‘ä»¬æ¥çœ‹çœ‹ POST è¯·æ±‚ï¼š

POST åœ¨è¯­ä¹‰ä¸Šæ˜¯ä¼ è¾“å®ä½“ä¸»ä½“ï¼ŒGET æ˜¯è·å–èµ„æº

POST å¸¸ç”¨ä¸æäº¤è¡¨å•ç­‰

```js
request.open("POST", POSTAPI)
request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
// è¿™æ ·å°±å°†æ•°æ®æ”¾åœ¨äº†è¯·æ±‚ä½“ï¼ˆrequest bodyï¼‰ä¸­
request.send("name=hzh&age=18&nb=true")
```

æˆ–è€…å…¶ä»–æ ¼å¼, ç±»ä¼¼ multipart/form-dataã€application/json ç­‰ï¼Œåªè¦è®¾ç½®å¥½è¯·æ±‚å¤´çš„ç›¸åº”çš„ Content-Type

å…¶ä»–æ–¹æ³•ä¼ å‚æ–¹å¼å¤§åŒå°å¼‚

### è·¨åŸŸ

> è·¨åŸŸæ¡ä»¶ï¼šåè®®ï¼ŒåŸŸåï¼Œç«¯å£ï¼Œæœ‰ä¸€ä¸ªä¸åŒå°±ç®—è·¨åŸŸã€‚

ä¾‹å¦‚ åœ¨https://www.baidu.comè¯·æ±‚www.taobao.comå°±ä¼šå‡ºç°è·¨åŸŸé—®é¢˜

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646267482.png)

è€Œç›´æ¥åœ¨https://www.taobao.com

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646281908.png)

ä¸ä¼šå‡ºç°è·¨åŸŸçš„é—®é¢˜

æµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶äº†ä»åŒä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„é‡è¦å®‰å…¨æœºåˆ¶ã€‚é€šå¸¸ä¸å…è®¸ä¸åŒæºé—´çš„è¯»æ“ä½œã€‚

#### è§£å†³è·¨åŸŸçš„æ–¹æ³•

ä¸‰ç§æ€è·¯

1. ç»•è¿‡æµè§ˆå™¨çš„åŒæºç­–ç•¥

   - ä½¿ç”¨ Nginx åå‘ä»£ç†

   - Node ä¸­é—´ä»¶ä»£ç†

2. å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªè·¨åŸŸå…è®¸

   - CORS

3. ä½¿ç”¨æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„æ–¹å¼

   - JSONP

   - postMessage

   - WebSocket

##### JSONP

`script`æ ‡ç­¾çš„`src`å±æ€§ä¸­çš„é“¾æ¥å¯ä»¥è®¿é—®è·¨åŸŸçš„`js`è„šæœ¬ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼ŒæœåŠ¡ç«¯ä¸å†è¿”å›`JSON`æ ¼å¼çš„æ•°æ®ï¼Œè€Œæ˜¯è¿”å›ä¸€æ®µè°ƒç”¨æŸä¸ªå‡½æ•°çš„`js`ä»£ç ï¼Œåœ¨`src`ä¸­è¿›è¡Œäº†è°ƒç”¨ï¼Œè¿™æ ·å®ç°äº†è·¨åŸŸã€‚

æˆ‘ä»¬æ¥çœ‹ ä¸€ä¸ªå¤©æ°”æŸ¥è¯¢æŸ¥è¯¢çš„ jsonp æ¥å£ https://query.asilu.com/weather/baidu/

å®ƒæœ‰ä¸€ä¸ªå‚æ•°æ˜¯ city

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646339350.png)

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ è¯·æ±‚ `https://api.asilu.com/weather/?city=${'é‡åº†'}&callback=weather`ä¼šè¿”å›ä»€ä¹ˆ

```js
/** api.asilu.com **/ weather({
  city: "é‡åº†",
  pm25: "62",
  weather: [
    {
      date: "å‘¨ä¸‰ 09æœˆ16æ—¥",
      icon1: "http://s1.bdstatic.com/r/www/aladdin/img/new_weath/bigicon/3",
      icon2: "http://s1.bdstatic.com/r/www/aladdin/img/new_weath/bigicon/3",
      weather: "é˜´è½¬å°é›¨",
      wind: "åŒ—é£å¾®é£",
      temp: "23 ~ 20â„ƒ",
    },
    {
      date: "å‘¨å››",
      icon1: "http://s1.bdstatic.com/r/www/aladdin/img/new_weath/icon/8",
      icon2: "",
      weather: "å°é›¨è½¬é˜´",
      wind: "åŒ—é£å¾®é£",
      temp: "22 ~ 19â„ƒ",
    },
    {
      date: "å‘¨äº”",
      icon1: "http://s1.bdstatic.com/r/www/aladdin/img/new_weath/icon/5",
      icon2: "",
      weather: "å¤šäº‘è½¬æ™´",
      wind: "ä¸œåŒ—é£å¾®é£",
      temp: "24 ~ 19â„ƒ",
    },
    {
      date: "å‘¨å…­",
      icon1: "http://s1.bdstatic.com/r/www/aladdin/img/new_weath/icon/1",
      icon2: "",
      weather: "æ™´è½¬å¤šäº‘",
      wind: "ä¸œåŒ—é£å¾®é£",
      temp: "28 ~ 21â„ƒ",
    },
  ],
  date: "2020-11-24",
  s: 1606147200,
})
```

æˆ‘ä»¬çœ‹åˆ°å“åº”ç»“æœæ˜¯ä¸€æ®µ js ä»£ç  è°ƒç”¨äº† weather å‡½æ•° è€Œç»™ weather å‡½æ•°ä¼ çš„æ•°æ®å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®

é‚£ weather åˆ°åº•æ˜¯å“ªæ¥çš„ï¼Ÿ

å…¶å®å°±æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„å‡½æ•°,æ¯”å¦‚æˆ‘çš„ weather å‡½æ•°æ˜¯è¿™ä¹ˆå†™çš„ï¼Œåœ¨æ‹¿åˆ° data ä¹‹åæ›´æ–° dom

```js
function weather(data) {
  const city = document.querySelector(".city")
  const weather = document.querySelector(".weather")
  city.innerText = data.city
  weather.innerText = data.weather[0].weather
}
```

ä¸‹ä¸€æ­¥å°±æ˜¯æŠŠè¿”å›çš„è¿™æ®µ js ä»£ç æ’å…¥åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸­äº†

```js
const script = document.createElement("script")
script.src = `https://api.asilu.com/weather/?city=${"é‡åº†"}&callback=weather`
document.body.appendChild(script)
```

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646317819.png)

æœ€ç»ˆæ•ˆæœ

![](https://cansiny.oss-cn-shanghai.aliyuncs.com/images/1613646404768-jsonp.gif)

##### CORS

å®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯åç«¯ã€‚åªè¦åç«¯å®ç°äº† CORSï¼Œå°±å®ç°äº†è·¨åŸŸã€‚

æœåŠ¡ç«¯è®¾ç½® `Access-Control-Allow-Origin` å°±å¯ä»¥å¼€å¯ CORSã€‚è¯¥å±æ€§è¡¨ç¤ºå“ªäº›åŸŸåå¯ä»¥è®¿é—®èµ„æºï¼Œå¦‚æœè®¾ç½®é€šé…ç¬¦ `*` åˆ™è¡¨ç¤ºæ‰€æœ‰ç½‘ç«™éƒ½å¯ä»¥è®¿é—®èµ„æºã€‚

Node.js å†™çš„åç«¯å®ç°è·¨åŸŸï¼š

å‰ç«¯æœ¬åœ°æœåŠ¡ 3000 ç«¯å£è·¨åˆ°åç«¯ 8080 ç«¯å£

```js
const http = require("http")

const cors = res => {
  // æ ¹æ®éœ€è¦è®¾ç½®
  res.setHeader("Access-Control-Allow-Origin", "http://127.0.0.1:8080")
  res.setHeader("Access-Control-Allow-Methods", "GET, POST, DELETE")
  res.setHeader("Access-Control-Allow-Headers", "X-TOKEN")
  res.setHeader("Access-Control-Allow-Credentials", true)
}

const server = http.createServer((request, response) => {
  cors(response) // ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºæ˜¯å¯¹å“åº”çš„å¤„ç†ï¼ŒåŠ å‡ ä¸ªå“åº”å¤´å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªå“åº”ä¸è¦é™åˆ¶ ğŸš«
  response.writeHead(200, { "Content-Type": "text/plain" })
  response.end("ok")
})

server.listen(8081, () => {
  console.log("Server is running at http://localhost:8081")
})
```

## JQuery ä¸­çš„ AJAX

> JQuery æ˜¯ä»€ä¹ˆï¼Ÿ
>
> jQuery æ˜¯ä¸€å¥—**è·¨æµè§ˆå™¨**çš„ JavaScript åº“ï¼Œ**ç®€åŒ– HTML ä¸ JavaScript ä¹‹é—´**çš„æ“ä½œ
>
> å¤§å®¶ç”¨åŸç”Ÿ JS æ“ä½œ DOM å†™ä½œä¸šæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆéº»çƒ¦ï¼Œè¢« DOM æ¶å¿ƒåˆ°äº†ï¼ˆå¦‚æœç°åœ¨æ²¡æœ‰ï¼Œä¸ä¹…åå°±æœ‰äº† ğŸ˜„ï¼‰ï¼ŒJQuery å°±æ˜¯ä¸ºäº†è®©å¼€å‘è€…ä¸è¢« DOM æ¶å¿ƒåˆ°ï¼ˆæ–¹ä¾¿æ“ä½œï¼‰è€Œè®¾è®¡å‡ºæ¥çš„åº“

æˆ‘ä»¬çœ‹çœ‹ç”¨ JQuery å°è£…å¥½çš„ ajax å‡½æ•°æ€ä¹ˆè°ƒæ¥å£ï¼š

```js
$("button").click(() => {
  $.ajax({
    type: "POST",
    url: "http://api.example.com/post",
    dataType: 'json', // è®¾ç½®è¿”å›å€¼ç±»å‹
    contentType: 'application/json', // è®¾ç½®å‚æ•°ç±»å‹
    headers: {'Content-Type','application/json'},// è®¾ç½®è¯·æ±‚å¤´
    xhrFields: { withCredentials: true }, // è·¨åŸŸæºå¸¦cookie
    data: JSON.stringify({a: [{b:1, a:1}]}), // ä¼ é€’å‚æ•°
    error:function(xhr,status){  // é”™è¯¯å¤„ç†
       console.log(xhr,status);
    },
    success: function (data,status) {  // è·å–ç»“æœ
       console.log(data,status);
    }
})

})
```

å¯ä»¥çœ‹åˆ°ç›¸æ¯”äºåŸç”Ÿ `open\send...` ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œè¿™æ˜¯å› ä¸º JQuery å·²ç»ä¸ºæˆ‘ä»¬å°è£…å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥ç›¸åº”çš„å‚æ•°ï¼ˆé…ç½®ï¼‰å³å¯

JQuery ä¸­çš„ AJAX è¿™ä¹ˆç®€å•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™èŠ‚è¯¾ä½œä¸šå°±æ˜¯å°è£…ç±»ä¼¼çš„å‡½æ•°.

## è¯´ä¸‹ fetch å’Œ axios

### fetch

fetch API æ˜¯ä¸€ä¸ªç”¨ç”¨äºè®¿é—®å’Œæ“çºµ HTTP ç®¡é“çš„å¼ºå¤§çš„åŸç”Ÿ APIï¼Œæ˜¯ä¸€ä¸ªéå¸¸åº•å±‚çš„ API

> è¿™ç§åŠŸèƒ½ä»¥å‰æ˜¯ä½¿ç”¨ XMLHttpRequest å®ç°çš„ã€‚Fetch æä¾›äº†ä¸€ä¸ªæ›´å¥½çš„æ›¿ä»£æ–¹æ³•ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«å…¶ä»–æŠ€æœ¯ä½¿ç”¨ï¼Œä¾‹å¦‚ Service Workersã€‚Fetch è¿˜æä¾›äº†å•ä¸ªé€»è¾‘ä½ç½®æ¥å®šä¹‰å…¶ä»– HTTP ç›¸å…³æ¦‚å¿µï¼Œä¾‹å¦‚ CORS å’Œ HTTP çš„æ‰©å±•ã€‚

fetch ç›¸æ¯”äºä¼ ç»Ÿçš„ XMLHttpRequest æ¥è¯´æœ‰è®¸å¤šå¥½å¤„ï¼Œæˆ‘ä»¬å…ˆç”¨ fetch æ¥å®ç°ä¸€ä¸‹æœ€å¼€å§‹çš„ç”¨ XMLHttpRequest å®ç° ajax çš„ä¾‹å­

```js
fetch("http://musicapi.leanapp.cn/personalized")
  .then(res => res.json())
  .then(console.log)
  .catch(console.error)
```

fetch()è¯·æ±‚è¿”å›çš„ res æ˜¯ Stream å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬è°ƒç”¨ res.json æ—¶ç”±äºå¼‚æ­¥è¯»å–æµå¯¹è±¡æ‰€ä»¥è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡

åˆ©ç”¨ ES2016 çš„ async/await è¿˜å¯ä»¥æ›´ä¼˜é›…ï¼š

```js
async function getData(url) {
  try {
    const res = await fetch(url)
    const json = await res.json()
    console.log(json)
  } catch (error) {
    console.log(error)
  }
}
```

å½“æˆ‘ä»¬ç”¨ fetch å‘é€ post è¯·æ±‚æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½® method å‚æ•°å’Œ body å‚æ•°ï¼Œå¦‚ä¸‹ï¼š

```js
fetch(url, {
  method: "post",
  headers: {
    "Content-type": "application/x-www-form-urlencoded; charset=UTF-8",
  },
  body: "foo=bar&lorem=ipsum",
})
```

å½“ç„¶ fetch ä¹Ÿæœ‰å¾ˆå¤šå‘ï¼Œæ¯”å¦‚ä¸èƒ½æ­£ç¡®çš„æ•è·é”™è¯¯ï¼Œä¸èƒ½ç›´æ¥ä¼ é€’ js å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¦å¤–ï¼Œfetch è¿˜ä¸æ”¯æŒè¶…æ—¶æ§åˆ¶ç­‰ï¼Œä½ ä»¬é‡åˆ°çš„æ—¶å€™å†å»äº†è§£å§

### axios

ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„ XMLHttpRequest è¯·æ±‚å°è£…åº“ï¼Œæ¯” JQuery.ajax è¿˜ä¼˜ç§€

ä»–æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹æ¯”å¦‚ï¼š

- å¯ä»¥åœ¨ node.js ä¸­ä½¿ç”¨ï¼ˆå½“ç„¶ node ä¸­ä¹Ÿæœ‰ node-fetchï¼‰
- æä¾›äº†å¹¶å‘è¯·æ±‚çš„æ¥å£
- æ”¯æŒ Promise API

ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œå¾ˆ fetch ç±»ä¼¼

```js
axios
  .get(url)
  .then(res => console.log(res.data))
  .catch(err => console.log(err))
```

é™„å¸¦ä¸€ä¸ªè‡ªå·±å¯¹ axios çš„å°è£…ï¼ˆå…¶å® axios å·²ç»å¾ˆæ–¹ä¾¿äº†ä¸éœ€è¦ç‰¹åˆ«å°è£…ï¼‰ï¼Œæ–¹ä¾¿ç®¡ç† api å’Œé…ç½®

[services](https://github.com/Cansiny0320/services)

## refs

[å…¨é¢åˆ†æå‰ç«¯çš„ç½‘ç»œè¯·æ±‚æ–¹å¼](https://juejin.cn/post/6844903807793512456)

[æµ…è°ˆå‰ç«¯ä¸ç½‘ç»œè¯·æ±‚](https://juejin.cn/post/6844903520336871432)
